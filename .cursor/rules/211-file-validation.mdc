---
description: USE WHEN creating new files or validating file locations to ensure proper placement and prevent duplication
globs:
  - "pepperpy/**/*.py"
  - "plugins/**/*.py"
  - "scripts/**/*.py"
alwaysApply: false
---

# File Validation and Pre-Creation Checks

## Overview

Esta regra define as verificações obrigatórias que DEVEM ser realizadas antes de criar novos arquivos no framework PepperPy. Essas verificações ajudam a prevenir duplicação, garantir a localização adequada e manter a consistência com o codebase existente.

## Mandatory Pre-Creation Workflow

### 1. Initial Search

SEMPRE execute estas buscas em TODO o codebase antes de criar qualquer arquivo:

```bash
# Busca por arquivos similares em todo o projeto
find . -type f -name "*similar_name*"

# Busca por conteúdo similar em todo o projeto
grep -r "similar_pattern" .

# Busca por imports ou referências em todo o projeto
grep -r "from pepperpy.similar" .
grep -r "import pepperpy.similar" .

# Busca por classes ou funções similares
grep -r "class Similar" .
grep -r "def similar" .

# Busca por padrões de implementação similares
grep -r "pattern" .
```

### 2. Module Structure Verification

SEMPRE verifique a estrutura do módulo alvo:

```bash
# Estrutura esperada para módulos:
module/
├── __init__.py         # Public API
├── base.py            # Domain interfaces
├── providers/         # Implementations
│   └── __init__.py
└── utils/             # Module utilities
    └── __init__.py
```

### 3. Core Framework Check

SEMPRE verifique se a funcionalidade não deveria estar no core:

```bash
pepperpy/core/
├── base.py      # Base classes and interfaces
├── errors.py    # Framework exceptions
├── config.py    # Configuration management
└── utils.py     # Shared utilities
```

## File Type Specific Validation

### 1. Error Classes

DEVE verificar antes de criar código relacionado a erros:

1. **Verificar Erros do Core**
   ```python
   # In pepperpy/core/errors.py
   class PepperpyError(Exception): ...
   class ValidationError(PepperpyError): ...
   class ProviderError(PepperpyError): ...
   ```

2. **Verificar Erros do Domínio**
   ```python
   # In domain/base.py
   from pepperpy.core import PepperpyError
   class DomainError(PepperpyError): ...
   ```

❌ **NUNCA criar arquivos de erro isolados**
```python
# ERRADO: Criar novo arquivo de erro
# new_errors.py  # ERRADO - Deve estender do core
class CustomError(Exception):
    pass
```

✅ **SEMPRE estender erros do core**
```python
# Correto: Estender do core
from pepperpy.core import PepperpyError

class SpecificError(PepperpyError):
    pass
```

### 2. Provider Classes

DEVE verificar antes de criar implementações de providers:

1. **Verificar Interfaces Base**
   ```python
   # In pepperpy/core/base.py
   class BaseProvider: ...
   ```

2. **Verificar Interfaces do Domínio**
   ```python
   # In domain/base.py
   class DomainProvider(Protocol): ...
   ```

❌ **NUNCA criar providers isolados**
```python
# ERRADO: Criar provider sem interface
class NewProvider:  # ERRADO - Deve implementar interface
    pass
```

✅ **SEMPRE implementar interfaces**
```python
# Correto: Implementar interface
from ..base import DomainProvider

class SpecificProvider(DomainProvider):
    pass
```

### 3. Utility Functions

DEVE verificar antes de criar funções utilitárias:

1. **Verificar Utils do Core**
   ```python
   # In pepperpy/core/utils.py
   def shared_utility(): ...
   ```

2. **Verificar Utils do Domínio**
   ```python
   # In domain/utils.py
   def domain_utility(): ...
   ```

❌ **NUNCA duplicar utilitários**
```python
# ERRADO: Criar utilitário duplicado
def format_string():  # ERRADO - Verificar core/utils primeiro
    pass
```

✅ **SEMPRE usar utilitários existentes**
```python
# Correto: Importar utilitário existente
from pepperpy.core.utils import format_string
```

## Location Validation

### 1. Core Framework Files

Estes arquivos DEVEM estar em `pepperpy/core/`:
- Exceções base (`errors.py`)
- Interfaces core (`base.py`)
- Utilitários compartilhados (`utils.py`)
- Configuração (`config.py`)

### 2. Domain-Specific Files

Estes arquivos DEVEM estar em seus respectivos domínios:
- Interfaces do domínio (`base.py`)
- Implementações de providers (`providers/`)
- Utilitários específicos do domínio (`utils/`)

### 3. Provider Implementations

Estes arquivos DEVEM estar em `providers/`:
- Classes específicas de providers
- Utilitários de providers
- Configurações de providers

## Common Pitfalls

### 1. Wrong File Location

❌ **NUNCA colocar arquivos no lugar errado**
```python
# ERRADO: Provider na raiz
# domain/provider.py  # ERRADO - Deve estar em providers/
```

✅ **SEMPRE usar localização correta**
```python
# Correto: Provider em providers/
# domain/providers/specific_provider.py
```

### 2. Duplicate Files

❌ **NUNCA criar duplicatas**
```python
# ERRADO: Criar funcionalidade duplicada
# new_memory.py  # ERRADO - Verificar se existe em core/
```

✅ **SEMPRE verificar primeiro**
```bash
# Correto: Buscar antes de criar
find pepperpy -type f -name "*memory*.py"
grep -r "class Memory" pepperpy/
```

### 3. Interface Duplication

❌ **NUNCA duplicar interfaces**
```python
# ERRADO: Criar nova interface
class Provider:  # ERRADO - Verificar base.py primeiro
    pass
```

✅ **SEMPRE usar interfaces existentes**
```python
# Correto: Usar interface existente
from pepperpy.core.base import BaseProvider
```

## Validation Process

### 1. Initial Checks

DEVE realizar estas verificações primeiro:
1. Buscar em todo o codebase por arquivos similares
2. Buscar em todo o codebase por conteúdo similar
3. Verificar imports e referências

### 2. Structure Analysis

DEVE verificar estrutura:
1. Verificar organização do módulo
2. Verificar localização dos arquivos
3. Revisar padrões de nomenclatura

### 3. Content Review

DEVE revisar conteúdo:
1. Verificar implementações similares
2. Revisar interfaces
3. Analisar dependências

### 4. Location Confirmation

DEVE confirmar localização:
1. Verificar diretório correto
2. Verificar limites do módulo
3. Validar convenções de nomenclatura

## Error Prevention

### 1. Common Errors

- Criar novos arquivos de erro em vez de estender do core
- Duplicar utilitários em vez de importar
- Colocar providers fora de providers/

### 2. Prevention Steps

1. SEMPRE verificar o core primeiro
2. SEMPRE buscar por arquivos similares
3. SEMPRE verificar estrutura do módulo
4. NUNCA pular etapas de validação

### 3. When in Doubt

1. Pedir esclarecimento
2. Revisar implementações similares
3. Verificar documentação do framework
4. Consultar membros da equipe

## Conclusion

Esta regra DEVE ser seguida antes de criar qualquer arquivo novo. Seguir estas etapas de validação garante:
1. Sem implementações duplicadas
2. Localização adequada dos arquivos
3. Estrutura consistente
4. Reusabilidade de código
5. Codebase manutenível

NUNCA pule estas etapas de validação. Em caso de dúvida, reúna mais informações antes de prosseguir. 