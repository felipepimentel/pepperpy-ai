name: workflow/repository_analyzer
version: 0.1.0
description: Workflow for analyzing code repositories and providing insights
author: PepperPy Team
license: MIT
type: workflow

config_schema:
  repository_path:
    type: string
    description: Path to the repository to analyze
    default: "."
  analysis_types:
    type: array
    description: Types of analysis to perform
    default: ["code_quality", "structure", "complexity"]
    items:
      type: string
      enum: ["code_quality", "structure", "complexity", "dependencies", "security", "documentation"]
  include_patterns:
    type: array
    description: Glob patterns for files to include in analysis
    default: ["**/*.py", "**/*.js", "**/*.ts", "**/*.java", "**/*.c", "**/*.cpp", "**/*.go"]
    items:
      type: string
  exclude_patterns:
    type: array
    description: Glob patterns for files to exclude from analysis
    default: ["**/node_modules/**", "**/__pycache__/**", "**/.git/**", "**/venv/**", "**/.env/**"]
    items:
      type: string
  max_files:
    type: integer
    description: Maximum number of files to analyze
    default: 1000
  llm_provider:
    type: string
    description: LLM provider to use for analysis
    default: "openai"
  llm_model:
    type: string
    description: LLM model to use for analysis
    default: "gpt-4"
  output_dir:
    type: string
    description: Directory to save analysis results
    default: "./output/repository_analysis"

documentation:
  description: |
    Repository Analyzer Workflow provides tools for analyzing code repositories
    and generating insights, supporting:
    
    1. Code quality analysis
    2. Repository structure analysis
    3. Code complexity analysis
    4. Dependency analysis
    5. Security vulnerability scanning
    6. Documentation coverage assessment
    
    This workflow can be used to understand repositories, identify issues,
    and provide recommendations for improvements.
  
  features:
    - Code Analysis: Analyze code quality, complexity, and structure
    - Dependency Analysis: Identify and analyze dependencies
    - Security Scanning: Check for security vulnerabilities
    - Documentation Assessment: Evaluate documentation coverage
    - Integrated Insights: Generate comprehensive reports with AI-powered insights

  usage_examples:
    - title: Basic Repository Analysis
      python: |
        from pepperpy.workflow import create_provider
        
        # Create the repository analyzer workflow provider
        workflow = create_provider("repository_analyzer", 
                                  repository_path="./my_project",
                                  analysis_types=["code_quality", "structure"])
        
        # Run analysis
        result = await workflow.execute({
            "task": "analyze_repository",
            "input": {
                "output_format": "markdown"
            }
        })
        
        # Print summary
        print(result["summary"])
        print(f"Analysis saved to: {result['output_path']}")
        
    - title: Focused Analysis
      python: |
        # Create workflow with focused analysis
        workflow = create_provider("repository_analyzer", 
                                  repository_path="./my_project",
                                  include_patterns=["**/src/**/*.py"],
                                  exclude_patterns=["**/tests/**"],
                                  analysis_types=["complexity"])
        
        # Run specific analysis
        result = await workflow.execute({
            "task": "analyze_complexity",
            "input": {
                "metrics": ["cyclomatic", "cognitive"],
                "threshold": "medium"
            }
        })
        
        # Process results
        issues = result["issues"]
        print(f"Found {len(issues)} complexity issues")
        for issue in issues:
            print(f"- {issue['file']}: {issue['description']}")
        
    - title: Command Line Usage
      shell: |
        # Run repository analysis via CLI
        python -m pepperpy.cli workflow run workflow/repository_analyzer \
          --params "repository_path=./my_project" \
          --params "analysis_types=[code_quality,documentation]" \
          --params "task=analyze_repository" \
          --params "output_format=markdown"

requirements:
  - pydantic>=2.0.0
  - jsonschema>=4.0.0
  - radon>=5.1.0 