---
title: Consolida√ß√£o de Providers e Services
task: TASK-007
code: R002
status: üìã To Do
created: 2024-02-22
updated: 2024-02-22
started: null
completed: null
---

# Requirement
Consolidar os providers e services em uma estrutura unificada, movendo servi√ßos LLM para localiza√ß√£o correta e eliminando duplica√ß√µes.

# Dependencies
- Conclus√£o do R001 (Monitoring)
- Mapeamento de todos os providers existentes
- An√°lise de depend√™ncias entre servi√ßos

## Current State
```python
# Duplica√ß√£o entre providers/ e agents/providers/services/
# Mesmas responsabilidades em locais diferentes
# Servi√ßos LLM (openai.py, anthropic.py, etc) em local incorreto
```

## Implementation
- Mover servi√ßos LLM para `providers/llm/`:
  - `agents/providers/services/openai.py` ‚Üí `providers/llm/openai.py`
  - `agents/providers/services/anthropic.py` ‚Üí `providers/llm/anthropic.py`
  - `agents/providers/services/gemini.py` ‚Üí `providers/llm/gemini.py`
  - `agents/providers/services/perplexity.py` ‚Üí `providers/llm/perplexity.py`
  - `agents/providers/services/openrouter.py` ‚Üí `providers/llm/openrouter.py`
- Consolidar bases:
  - Unificar `agents/providers/services/base.py` com `providers/base.py`
- Remover diret√≥rio `agents/providers/services` ap√≥s migra√ß√£o

## Validation
```python
def test_provider_migration():
    # Verificar que providers foram migrados corretamente
    from pepperpy.providers.llm import OpenAIProvider
    provider = OpenAIProvider()
    assert provider.is_available()
    
    # Verificar base unificada
    from pepperpy.providers.base import BaseProvider
    assert issubclass(OpenAIProvider, BaseProvider)
    
    # Verificar que diret√≥rio antigo foi removido
    import os
    assert not os.path.exists("pepperpy/agents/providers/services")
```

## Rollback Plan
1. Backup de todos os arquivos de provider
2. Script para restaurar estrutura original:
   ```python
   def restore_providers():
       # Restaurar arquivos de backup
       shutil.copytree("backup/providers", "pepperpy/providers")
       shutil.copytree("backup/agents/providers", "pepperpy/agents/providers")
   ```
3. Testes de regress√£o para validar restaura√ß√£o

## Success Metrics
- [ ] 100% dos providers migrados
- [ ] Zero duplica√ß√µes de c√≥digo
- [ ] Todos os testes passando
- [ ] Documenta√ß√£o atualizada
- [ ] APIs p√∫blicas mantidas

# Progress Updates

## 2024-02-22
- Status: Planejamento inicial
- Progress: Mapeamento de providers e an√°lise de impacto 