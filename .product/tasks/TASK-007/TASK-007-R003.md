---
title: ReestruturaÃ§Ã£o de Capabilities e Events
task: TASK-007
code: R003
status: ğŸ“‹ To Do
created: 2024-02-22
updated: 2024-02-22
started: null
completed: null
---

# Requirement
Reestruturar o sistema de capabilities e events, consolidando funcionalidades dispersas e eliminando duplicaÃ§Ãµes.

# Dependencies
- ConclusÃ£o do R002 (Providers)
- Mapeamento de capabilities existentes
- AnÃ¡lise de eventos e handlers

## Current State
```python
# MÃ³dulo capabilities/ com arquivos dispersos
# Capabilities em core/providers que deveriam estar em capabilities/
# DuplicaÃ§Ã£o entre events/ e core/events/
```

## Implementation
- Mover capabilities de `core/providers/` para `capabilities/`
- Consolidar eventos:
  - Unificar `core/events/base.py` com `events/base.py`
  - Unificar `core/events/middleware.py` com `events/middleware.py`
  - Mover handlers unificados para `events/handlers/`
- Estrutura final:
  ```
  capabilities/
  â”œâ”€â”€ __init__.py
  â”œâ”€â”€ base.py
  â”œâ”€â”€ types.py
  â””â”€â”€ providers/      # Movido de core/providers

  events/
  â”œâ”€â”€ __init__.py
  â”œâ”€â”€ base.py        # Unificado
  â”œâ”€â”€ dispatcher.py
  â”œâ”€â”€ middleware.py  # Unificado
  â”œâ”€â”€ handlers/
  â””â”€â”€ hooks/
  ```

## Validation
```python
def test_capabilities_and_events():
    # Verificar capabilities
    from pepperpy.capabilities.providers import ProviderCapability
    assert ProviderCapability is not None
    
    # Verificar eventos unificados
    from pepperpy.events import EventDispatcher
    assert EventDispatcher.get_handlers() is not None
    
    # Verificar middleware
    from pepperpy.events.middleware import EventMiddleware
    assert EventMiddleware.process_event("test") is not None
    
    # Verificar que diretÃ³rios antigos foram removidos
    import os
    assert not os.path.exists("pepperpy/core/events")
    assert not os.path.exists("pepperpy/core/providers/capabilities")
```

## Rollback Plan
1. Backup de todos os arquivos de capabilities e events
2. Script para restaurar estrutura original:
   ```python
   def restore_structure():
       # Restaurar capabilities
       shutil.copytree("backup/capabilities", "pepperpy/capabilities")
       shutil.copytree("backup/core/providers", "pepperpy/core/providers")
       
       # Restaurar events
       shutil.copytree("backup/events", "pepperpy/events")
       shutil.copytree("backup/core/events", "pepperpy/core/events")
   ```
3. Testes de regressÃ£o para validar restauraÃ§Ã£o

## Success Metrics
- [ ] 100% das capabilities migradas
- [ ] Sistema de eventos unificado
- [ ] Zero duplicaÃ§Ãµes de cÃ³digo
- [ ] Todos os testes passando
- [ ] DocumentaÃ§Ã£o atualizada
- [ ] APIs pÃºblicas mantidas

# Progress Updates

## 2024-02-22
- Status: Planejamento inicial
- Progress: Mapeamento de capabilities e eventos 