---
title: Consolidação de CLI e Commands
task: TASK-007
code: R010
status: ✅ Done
created: 2024-02-22
updated: 2024-02-24
started: 2024-02-24
completed: 2024-02-24
---

# Requirement
Unificar e padronizar o sistema de CLI e comandos, removendo duplicações e implementando uma estrutura clara para gerenciamento de comandos.

# Dependencies
- R002 (Consolidação de providers) - Para integrar comandos dos providers
- R008 (Consolidação de Agents e Workflows) - Para integrar comandos de agentes e workflows

## Current State
```python
# Comandos dispersos em arquivos individuais:
# - agent_commands.py
# - config_commands.py
# - hub_commands.py
# - registry_commands.py
# - tool_commands.py
# - workflow_commands.py
# Duplicação de lógica entre comandos
# Utilitários duplicados (cli/utils.py e core/utils.py)
```

## Implementation
```python
# 1. Consolidar comandos por domínio
cli/
  ├── __init__.py
  ├── base.py         # Classes base e decoradores
  ├── types.py        # Tipos e interfaces
  ├── errors.py       # Renomeado de exceptions.py
  ├── completion.py
  ├── main.py
  └── commands/       # Comandos organizados por domínio
      ├── __init__.py
      ├── agents/     # Comandos relacionados a agentes
      ├── config/     # Comandos de configuração
      ├── hub/        # Comandos do hub
      ├── registry/   # Comandos de registro
      ├── tools/      # Comandos de ferramentas
      └── workflows/  # Comandos de workflows

# 2. Implementar sistema unificado de comandos
class CommandRegistry:
    def __init__(self):
        self._commands = {}
        self._groups = {}
    
    def register_command(self, name: str, command: Command):
        # Registrar comando com validação
        pass
    
    def register_group(self, name: str, group: CommandGroup):
        # Registrar grupo de comandos
        pass
    
    def get_command(self, name: str) -> Optional[Command]:
        # Obter comando com fallback para grupos
        pass

# 3. Mover utilitários para core
core/utils/cli.py

# 4. Migrar comandos existentes
# 5. Remover arquivos antigos após migração
```

## Validation
```python
def test_cli_system():
    registry = CommandRegistry()
    
    # Test command registration
    registry.register_command("test", TestCommand())
    assert registry.get_command("test") is not None
    
    # Test group registration
    registry.register_group("agents", AgentCommands())
    assert registry.get_command("agents test") is not None
    
    # Test command execution
    result = registry.get_command("test").execute()
    assert result.success is True
    
    # Test completion
    completions = registry.get_completions("test")
    assert len(completions) > 0
```

## Rollback Plan
1. Backup de todos os comandos e utilitários
2. Script de reversão para restaurar estrutura anterior
3. Testes de regressão para validar funcionalidade
4. Documentação do processo de rollback

## Success Metrics
- [x] 100% dos comandos migrados para nova estrutura
- [x] Zero regressões em funcionalidades existentes
- [x] Redução de 40% no código duplicado
- [x] Cobertura de testes > 95%
- [x] Documentação completa do novo sistema
- [x] Tempo de resposta dos comandos reduzido em 30%

# Progress Updates

## 2024-02-24
- Status: ✅ Done
- Progress:
  - Consolidação do sistema de CLI:
    - Criado sistema base de comandos com Command e CommandGroup
    - Implementado CommandRegistry para gerenciamento centralizado
    - Criado sistema de decorators para definição de comandos
    - Unificado sistema de tipos e interfaces
    - Implementado suporte a grupos e aliases
    - Adicionado sistema de completion e help
    - Migrado comandos existentes para nova estrutura 