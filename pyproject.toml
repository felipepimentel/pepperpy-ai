[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 88
target-version = ["py39"]
include = '\.pyi?$'

[tool.isort]
profile = "black"
line_length = 88
multi_line_output = 3

[tool.mypy]
python_version = "3.9"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
disallow_untyped_decorators = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true

[[tool.mypy.overrides]]
module = "pepperpy.pipeline.base"
ignore_errors = true

[[tool.mypy.overrides]]
module = "numpy.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "pandas.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "matplotlib.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "scipy.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "torch.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = ["annoy.*", "chromadb.*"]
ignore_missing_imports = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = "test_*.py"
asyncio_mode = "auto"
addopts = "--cov=pepperpy --cov-report=term-missing"

[tool.poetry]
name = "pepperpy"
version = "0.1.0"
description = "A Python framework for building AI-powered applications"
authors = ["Your Name <your.email@example.com>"]
readme = "README.md"
packages = [{ include = "pepperpy" }]

[tool.poetry.dependencies]
python = ">=3.9,<3.13"
aiohttp = "^3.9.3"
pydantic = "^2.6.3"
python-dotenv = "^1.0.1"
tenacity = "^8.2.3"
loguru = "^0.7.2"
httpx = "^0.28.1"
psutil = "^7.0.0"

# Core ML Dependencies (Optional)
numpy = { version = "^1.26.4", optional = true }
spacy = { version = "^3.8.4", optional = true }
nltk = { version = "^3.9.1", optional = true }
sentence-transformers = { version = "^4.0.1", extras = [
    "embeddings-local",
], optional = true }

# Code Analysis Dependencies (Optional)
radon = { version = "^6.0.1", optional = true }
lizard = { version = "^1.17.20", optional = true }
gitpython = { version = "^3.1.44", optional = true }
PyGithub = { version = "^2.6.1", optional = true }

# Vector Store Dependencies (Optional)
annoy = { version = "^1.17.3", optional = true }
chromadb = { version = "^0.4.24", optional = true }
tiktoken = { version = "^0.6.0", optional = true }

# Document Processing Dependencies (Optional)
pypdf2 = { version = "^3.0.0", optional = true }
python-docx = { version = "^1.0.0", optional = true }
pdfkit = { version = "^1.0.0", optional = true }
markdown2pdf = { version = "^0.1.4", optional = true }
reportlab = { version = "^4.0.0", optional = true }
fpdf2 = { version = "^2.8.2", optional = true }

# LLM Provider Dependencies (Optional)
openai = { version = "^1.14.0", optional = true }
anthropic = { version = "^0.49.0", optional = true }
llm-openrouter = { version = "^0.4", optional = true }

# Vector Store Provider Dependencies (Optional)
weaviate-client = { version = "^4.11.3", optional = true }
pinecone-client = { version = "^6.0.0", optional = true }

# Storage Provider Dependencies (Optional)
boto3 = { version = "^1.37.19", optional = true }
google-cloud-storage = { version = "^3.1.0", optional = true }
supabase = { version = "^2.14.0", optional = true }

# TTS Provider Dependencies (Optional)
azure-cognitiveservices-speech = { version = "^1.35.0", optional = true }
gtts = { version = "^2.5.4", optional = true }
pyyaml = "^6.0.2"

[tool.poetry.group.dev.dependencies]
pytest = "^8.0.2"
pytest-asyncio = "^0.23.5"
pytest-cov = "^4.1.0"
black = "^24.2.0"
isort = "^5.13.2"
mypy = "^1.8.0"
ruff = "^0.5.3"

[tool.poetry.extras]
# Core ML Features
ml = ["numpy", "spacy", "nltk", "sentence-transformers"]
code-analysis = ["radon", "lizard", "gitpython", "PyGithub"]
vector-store = ["annoy", "chromadb", "tiktoken"]

# Document Processing Providers
pdf = ["pypdf2", "pdfkit", "reportlab", "fpdf2"]
docx = ["python-docx"]
markdown = ["markdown2pdf"]
doc-all = [
    "pypdf2",
    "pdfkit",
    "reportlab",
    "fpdf2",
    "python-docx",
    "markdown2pdf",
]

# LLM Providers
openai = ["openai"]
anthropic = ["anthropic"]
openrouter = ["llm-openrouter"]
llm-all = ["openai", "anthropic", "llm-openrouter"]

# RAG Providers
chroma = ["chromadb", "tiktoken"]
weaviate = ["weaviate-client"]
pinecone = ["pinecone-client"]
rag-all = ["chromadb", "weaviate-client", "pinecone-client", "tiktoken"]

# Storage Providers
s3 = ["boto3"]
gcs = ["google-cloud-storage"]
supabase = ["supabase"]
storage-all = ["boto3", "google-cloud-storage", "supabase"]

# TTS Providers
azure-tts = ["azure-cognitiveservices-speech"]
google-tts = ["gtts"]
tts-all = ["azure-cognitiveservices-speech", "gtts"]

# Feature Groups
ml-complete = ["ml", "vector-store"]
analysis-complete = ["ml", "code-analysis"]
rag-complete = ["ml", "vector-store", "rag-all"]

# All providers and features
all = [
    # Core Features
    "ml",
    "code-analysis",
    "vector-store",
    # Document Processing
    "doc-all",
    # LLM Providers
    "llm-all",
    # RAG Providers
    "rag-all",
    # Storage Providers
    "storage-all",
    # TTS Providers
    "tts-all",
]

[tool.coverage.run]
source = ["pepperpy"]
omit = ["tests/*", "**/__init__.py"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "pass",
    "raise ImportError",
]

[tool.ruff]
line-length = 88
target-version = "py39"
select = [
    "E", # pycodestyle errors
    "W", # pycodestyle warnings
    "F", # pyflakes
    "I", # isort
    "C", # flake8-comprehensions
    "B", # flake8-bugbear
]
ignore = [
    "E501", # line too long, handled by black
    "B008", # do not perform function calls in argument defaults
    "C901", # too complex
]

[tool.ruff.per-file-ignores]
"__init__.py" = ["F401"]
