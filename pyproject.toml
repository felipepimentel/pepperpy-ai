[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 88
target-version = ["py39"]
include = '\.pyi?$'

[tool.isort]
profile = "black"
line_length = 88
multi_line_output = 3

[tool.mypy]
python_version = "3.9"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
disallow_untyped_decorators = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true

[[tool.mypy.overrides]]
module = "pepperpy.pipeline.base"
ignore_errors = true

[[tool.mypy.overrides]]
module = "numpy.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "pandas.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "matplotlib.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "scipy.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "torch.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = ["annoy.*", "chromadb.*"]
ignore_missing_imports = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = "test_*.py"
asyncio_mode = "auto"
addopts = "--cov=pepperpy --cov-report=term-missing"

[tool.poetry]
name = "pepperpy"
version = "0.1.0"
description = "A framework for building AI-powered applications with RAG and LLM capabilities"
authors = ["Pimenta <pimentel@gmail.com>"]
readme = "README.md"
packages = [{ include = "pepperpy" }]

[tool.poetry.dependencies]
python = "^3.9"
aiohttp = "^3.9.3"
pydantic = "^2.6.3"
python-dotenv = "^1.0.1"
openai = "^1.12.0"
numpy = "^1.26.4"
annoy = "^1.17.3"
chromadb = "^0.4.22"
tiktoken = "^0.6.0"
tenacity = "^8.2.3"
loguru = "^0.7.2"
httpx = "^0.28.1"
radon = "^6.0.1"
lizard = "^1.17.20"
gitpython = "^3.1.44"

# Optional dependencies
anthropic = { version = "^0.49.0", optional = true }
llm-openrouter = { version = "^0.4", optional = true }
weaviate-client = { version = "^4.11.3", optional = true }
pinecone-client = { version = "^6.0.0", optional = true }
boto3 = { version = "^1.37.19", optional = true }
google-cloud-storage = { version = "^3.1.0", optional = true }
supabase = { version = "^2.14.0", optional = true }
azure-cognitiveservices-speech = { version = "^1.43.0", optional = true }
gtts = { version = "^2.5.4", optional = true }

[tool.poetry.group.dev.dependencies]
pytest = "^8.0.2"
pytest-asyncio = "^0.23.5"
pytest-cov = "^4.1.0"
black = "^24.2.0"
isort = "^5.13.2"
mypy = "^1.8.0"
ruff = "^0.2.2"

[tool.poetry.extras]
# LLM Providers
openai = ["openai"]
anthropic = ["anthropic"]
openrouter = ["llm-openrouter"]
llm-all = ["openai", "anthropic", "llm-openrouter"]

# RAG Providers
chroma = ["chromadb"]
weaviate = ["weaviate-client"]
pinecone = ["pinecone-client"]
rag-all = ["chromadb", "weaviate-client", "pinecone-client"]

# Storage Providers
s3 = ["boto3"]
gcs = ["google-cloud-storage"]
supabase = ["supabase"]
storage-all = ["boto3", "google-cloud-storage", "supabase"]

# TTS Providers
azure-tts = ["azure-cognitiveservices-speech"]
google-tts = ["gtts"]
tts-all = ["azure-cognitiveservices-speech", "gtts"]

# All providers
all = [
    "openai",
    "anthropic",
    "llm-openrouter",
    "chromadb",
    "weaviate-client",
    "pinecone-client",
    "boto3",
    "google-cloud-storage",
    "supabase",
    "azure-cognitiveservices-speech",
    "gtts",
]

[tool.coverage.run]
source = ["pepperpy"]
omit = ["tests/*", "**/__init__.py"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "pass",
    "raise ImportError",
]

[tool.ruff]
line-length = 88
target-version = "py39"
select = [
    "E", # pycodestyle errors
    "W", # pycodestyle warnings
    "F", # pyflakes
    "I", # isort
    "C", # flake8-comprehensions
    "B", # flake8-bugbear
]
ignore = [
    "E501", # line too long, handled by black
    "B008", # do not perform function calls in argument defaults
    "C901", # too complex
]

[tool.ruff.per-file-ignores]
"__init__.py" = ["F401"]
